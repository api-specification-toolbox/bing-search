<!DOCTYPE html>
<html>
   <head>

      <meta charset="utf-8">
      <title>Bing Search</title>
      <link href="http://assets.specificationtoolbox.com/css/bootstrap.css" rel="stylesheet">
      <link href="http://assets.specificationtoolbox.com/plugins/revolution/css/settings.css" rel="stylesheet" type="text/css">
      <link href="http://assets.specificationtoolbox.com/plugins/revolution/css/layers.css" rel="stylesheet" type="text/css">
      <link href="http://assets.specificationtoolbox.com/plugins/revolution/css/navigation.css" rel="stylesheet" type="text/css">
      <link href="http://assets.specificationtoolbox.com/css/style.css" rel="stylesheet">
      <link href="http://assets.specificationtoolbox.com/css/responsive.css" rel="stylesheet">
      <link href="http://assets.specificationtoolbox.com/css/color-switcher-design.css" rel="stylesheet">
      <link id="theme-color-file" href="http://assets.specificationtoolbox.com/css/color-themes/default-theme.css" rel="stylesheet">
      <link rel="shortcut icon" href="http://assets.specificationtoolbox.com/images/favicon.png" type="image/x-icon">
      <link rel="icon" href="http://assets.specificationtoolbox.com/images/favicon.png" type="image/x-icon">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">

      <!-- Github.js - http://github.com/michael/github -->
      <script src="http://assets.specificationtoolbox.com/js/github.js" type="text/javascript" charset="utf-8"></script>

      <!-- Cookies.js - http://github.com/ScottHamper/Cookies -->
      <script src="http://assets.specificationtoolbox.com/js/cookies.js"></script>

      <!-- js-yaml - http://github.com/nodeca/js-yaml -->
      <script src="http://assets.specificationtoolbox.com/js-yaml.min.js"></script>

      <!-- js-yaml - http://github.com/nodeca/js-yaml -->
      <script src="http://assets.specificationtoolbox.com/tabletop.js" type="text/javascript"></script>

      <style>
        .button {
          background-color: #000;
          border: none;
          color: white;
          padding: 20px;
          text-align: center;
          text-decoration: none;
          display: inline-block;
          font-size: 16px;
          margin: 5px;
        }

        .button1 {border-radius: 2px;}
        .button2 {border-radius: 4px;}
        .button3 {border-radius: 8px;}
        .button4 {border-radius: 12px;}
        .button5 {border-radius: 50%;}
      </style>

   </head>
   <body>

      <div class="page-wrapper">

         <!-- Preloader -->
         <div class="preloader"></div>

          <!-- Main Header -->
 <header class="main-header" style="border: 1px solid #FFF;">

    <div class="header-top">
       <div class="auto-container">
          <div class="row clearfix">

             <div class="top-left col-lg-4 col-md-12 col-sm-12">
                <ul class="clearfix">
                   <li style="color:#FFF;">Bing Search</li>
                </ul>
             </div>

             <div class="top-right pull-right col-lg-8 col-md-12 col-sm-12">
                <ul class="social-nav">
                   <li><a href="https://twitter.com/APISpecToolbox"><img src="http://assets.specificationtoolbox.com/images/social/twitter-logo-white.png" width="22"></a></li>
                   <li><a href="https://github.com/api-specification-toolbox/toolbox"><img src="http://assets.specificationtoolbox.com/images/social/github-logo-white.png" width="36"></a></li>
                </ul>
             </div>
          </div>
       </div>
    </div>

 </header>
 <!--End Header Style Two -->


         <div class="sidebar-page-container" style="margin: 0px; padding: 0px;">
  <div class="auto-container" style="margin-bottom: 0px; padding-bottom: 0px;">
    <div class="content-side col-lg-12 col-md-12 col-sm-12">

      <script type="text/javascript">

        // This isn't meant to be well-written JavaScript.
        // It is meant to be a hackable, trainable moment.
        // I've tried to document best that I can.
        // Lot's of cleanup needed

        // Reset the cookie manually
        //Cookies.expire('token')

        var $yaml_store = "";

        // When you fork, make sure ad add your org / user and repo name to _config.yml
        var $org = '';
        var $repo = '';

        function loadpage()
          {
          var $oAuthToken = document.getElementById('auth-token').value;

          if($oAuthToken !='')
            {

            // Setting a cookie value
            Cookies.set('token', $oAuthToken);

            // Set with expiration
            // Cookies.set('token', $oAuthToken, { expires: '01/01/2017' });

            }

          // Grab the token from cookie
          $oAuthToken = Cookies.get('token');

          // If we have a token!
          if($oAuthToken!='')
            {
            // Setup the Github connection
            var github = new Github({token: $oAuthToken,auth: "oauth"});
            var repo = github.getRepo($org,$repo);

            // Le'ts try to just get the Github Repo tree
            repo.getTree('gh-pages?recursive=true', function(err, tree) {

              if(err == null && $oAuthToken != null)
                {
                  // If no error we have access, read YAML store
                  repo.read('gh-pages', '_data/store.yaml', function(err, data) {

                    $yaml_store = jsyaml.load(data);

                    $( "#editor" ).append( "<tr><td colspan='2'><hr style='padding: 0px; margin: 0px;'></td></tr>");

                    $.each($yaml_store, function($rowKey, $rowEntry) {

                      $fieldNumKey = 0;
                      $.each($rowEntry, function($fieldKey, $fieldEntry) {
                        $( "#editor" ).append( "<tr id='row-" + $rowKey + "' style='padding: 3px 0px 3px 0px;'><td id='row-" + $rowKey + "-" + $fieldNumKey + "' align='right' style='font-weight: bold;'>" + $fieldKey + ":</td><td><input type='text' name='" + $fieldKey + "' id='text-" + $rowKey + "-" + $fieldNumKey + "' value='" + $fieldEntry + "' style='width: 100%;' /></td></tr>" );
                        $fieldNumKey++;
                      });

                      $( "#editor" ).append( "<tr><td colspan='2'><hr style='padding: 0px; margin: 0px;'></td></tr>");

                    });
                  });

                  // show button
                  document.getElementById('SaveYAML').style.display = '';

                }
              else
                {
                // If error we DO NOT have access
                alert('We have NO access to API & repo!');
                }

              });

            }
          }

        // Function for saving the pages
        function saveYAMLStore()
          {

            $('#editor tr').each(function (i, row) {
              $('#row-' + i + ' td').each(function (j, cell) {
                $id = 'text-' + i + '-' + j;
                if(document.getElementById($id))
                  {
                    $name = document.getElementById($id).name
                    $value = document.getElementById($id).value;
                    $yaml_store[i][$name] = $value;
                  }
              });

            });

            $yaml_dump = jsyaml.dump($yaml_store);

            // Grab the token from cookie
            $oAuthToken = Cookies.get('token');

            var github = new Github({token: $oAuthToken,auth: "oauth"});
            var repo = github.getRepo($org,$repo);

            repo.getTree('gh-pages?recursive=true', function(err, tree) {

              // I do not like looping through each item in tree, but only way I found to get SHA.
              $.each(tree, function(treeKey, treeValue) {

                $writepath = '_data/store.yaml';
                $path = treeValue['path'];
                $sha = treeValue['sha'];

                //console.log($path + ' == ' + $writepath);
                if($path==$writepath)
                  {
                  repo.writemanual('gh-pages',$writepath, $yaml_dump, 'Save', $sha, function(err) { });
                  //console.log("writing " + $writepath);
                  alert("saved " + $writepath);
                  }
                });
              });

          }

      </script>
      <h3>My Github YAML Editor Micro Tool Base</h3>
      <p>This is the editor for this micro application, and will load the yaml from _data/store.yaml if you have permission to this site, which can then be <a href="/github-micro-tool-yaml/">viewed by going back to home page</a>.</p>
      <p>You can <a href="https://github.com/api-evangelist-tools/github-micro-tool-yaml/issues">submit a Github issue for the project</a>, or hit me up at <a href="https://twitter.com/apievangelist">@apievangelist</a> to be added to permissions for the repository, or you can fork, publish as gh-pages in your own site, and use it there.
      <table width="100%" border="0" cellpadding="3" id="token">
          <tr>
            <td align="right"><a href="https://github.com/settings/tokens" target="_blank"><strong>Github Personal Auth Token:</strong></a></td>
            <td align="left"><input type="text" name="auth-token" id="auth-token" value="" size="50" /></td>
            <td align="right"><input type="button" name="loadpage" value="Load Data From YAML" onclick="loadpage();" /></td>
          </tr>
      </table>
      <table width="100%" border="0" cellpadding="3" id="editor"></table>
      <center><input style="display: none;" type="button" name="SaveYAML" id="SaveYAML" value="Save YAML" onclick="saveYAMLStore();" /></center>
      <p><br />Once you have a valid Github OAuth toke entered into the text box above, the page will load, and you should be able to save any changes to the underlying Github repository. Making for a completely self-contained, interactive web application, that can be used for any number of purposes.



    </div>
  </div>
</div>


          <footer class="main-footer" style="height: 50px;">
    <div class="footer-bottom" style="padding: 0px; margin:0px;">
       <div class="copyright-section">
          <div class="auto-container">
             <div class="row clearfix">
                <div class="col-lg-6 col-md-12 col-sm-12">
                   <ul class="footer-nav">
                      <li><a href="http://api.specificationtoolbox.com">API Specification Toolbox</a></li>
                   </ul>
                </div>
                <div class="col-lg-6 col-md-12 col-sm-12">
                   <div class="copyright">A <a href="https://postman.com" style="color: #FFF;">Postman</a> and <a href="https://apievangelist.com" style="color: #FFF;">API Evangelist</a> project to help define the API space.</div>
                </div>
             </div>
          </div>
       </div>
    </div>
 </footer>


      </div>
      <!--End pagewrapper-->

      <!--Scroll to top-->
      <div class="scroll-to-top scroll-to-target" data-target="html"><span class="icon fa fa-angle-double-up"></span></div>

      <!--[if lt IE 9]><script src="js/html5.js"></script><![endif]-->
      <!--[if lt IE 9]><script src="js/respond.js"></script><![endif]-->

      <script src="http://assets.specificationtoolbox.com/js/jquery.js"></script>

      <!--Revolution Slider-->
      <script src="http://assets.specificationtoolbox.com/plugins/revolution/js/jquery.themepunch.revolution.min.js"></script>
      <script src="http://assets.specificationtoolbox.com/plugins/revolution/js/jquery.themepunch.tools.min.js"></script>
      <script src="http://assets.specificationtoolbox.com/plugins/revolution/js/extensions/revolution.extension.actions.min.js"></script>
      <script src="http://assets.specificationtoolbox.com/plugins/revolution/js/extensions/revolution.extension.carousel.min.js"></script>
      <script src="http://assets.specificationtoolbox.com/plugins/revolution/js/extensions/revolution.extension.kenburn.min.js"></script>
      <script src="http://assets.specificationtoolbox.com/plugins/revolution/js/extensions/revolution.extension.layeranimation.min.js"></script>
      <script src="http://assets.specificationtoolbox.com/plugins/revolution/js/extensions/revolution.extension.migration.min.js"></script>
      <script src="http://assets.specificationtoolbox.com/plugins/revolution/js/extensions/revolution.extension.navigation.min.js"></script>
      <script src="http://assets.specificationtoolbox.com/plugins/revolution/js/extensions/revolution.extension.parallax.min.js"></script>
      <script src="http://assets.specificationtoolbox.com/plugins/revolution/js/extensions/revolution.extension.slideanims.min.js"></script>
      <script src="http://assets.specificationtoolbox.com/plugins/revolution/js/extensions/revolution.extension.video.min.js"></script>
      <script src="http://assets.specificationtoolbox.com/js/main-slider-script.js"></script>

      <!--End Revolution Slider-->
      <script src="http://assets.specificationtoolbox.com/js/popper.min.js"></script>
      <script src="http://assets.specificationtoolbox.com/js/bootstrap.min.js"></script>
      <script src="http://assets.specificationtoolbox.com/js/owl.js"></script>
      <script src="http://assets.specificationtoolbox.com/js/plyr.min.js"></script>
      <script src="http://assets.specificationtoolbox.com/js/isotope.js"></script>
      <script src="http://assets.specificationtoolbox.com/js/appear.js"></script>
      <script src="http://assets.specificationtoolbox.com/js/wow.js"></script>
      <script src="http://assets.specificationtoolbox.com/js/jquery.fancybox.js"></script>
      <script src="http://assets.specificationtoolbox.com/js/jquery.mCustomScrollbar.concat.min.js"></script>
      <script src="http://assets.specificationtoolbox.com/js/script.js"></script>
      <script src="http://assets.specificationtoolbox.com/js/color-settings.js"></script>

   </body>
</html>
